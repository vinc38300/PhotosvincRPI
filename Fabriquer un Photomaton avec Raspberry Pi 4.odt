 
# üì∏ Guide Complet : Fabriquer un Photomaton avec Raspberry Pi 4

## Mat√©riel n√©cessaire

### Composants principaux
- **Raspberry Pi 4** (2GB minimum, 4GB recommand√©)
- **Nikon D50** (appareil photo num√©rique)
- **√âcran tactile HDMI Display-C 1024x600** USB touch rev3.1
- **Imprimante photo** compatible CUPS (ex: Canon Selphy, Epson PictureMate)
- **Carte microSD** 32GB minimum (Classe 10)
- **Alimentation Raspberry Pi** 5V 3A USB-C
- **C√¢ble USB** pour le Nikon D50
- **C√¢ble USB** pour l'imprimante
- **Hub USB aliment√©** (recommand√© pour √©viter les probl√®mes de puissance)

### Mat√©riel optionnel
- Bo√Ætier/borne personnalis√©e
- Bouton arcade lumineux (si vous voulez un d√©clencheur physique)
- Enceintes USB pour le son
- LED RGB pour l'√©clairage

---

## üîß √âtape 1 : Pr√©paration du Raspberry Pi

### 1.1 Installation du syst√®me d'exploitation

```bash
# T√©l√©chargez Raspberry Pi OS (Desktop) depuis le site officiel
# Utilisez Raspberry Pi Imager pour flasher la carte SD

# Configuration initiale
sudo raspi-config
# > Interface Options > VNC : Activ√© (optionnel)
# > Display Options > Resolution : 1024x600 si n√©cessaire
# > Performance Options > GPU Memory : 256MB
```

### 1.2 Mise √† jour du syst√®me

```bash
sudo apt update
sudo apt upgrade -y
sudo reboot
```

---

## üì∑ √âtape 2 : Configuration du Nikon D50

### 2.1 Installation de gPhoto2

```bash
# Installation des outils de contr√¥le photo
sudo apt install -y gphoto2 libgphoto2-dev libgphoto2-6

# V√©rification de la version
gphoto2 --version
```

### 2.2 Configuration USB et permissions

```bash
# Ajout de l'utilisateur au groupe plugdev
sudo usermod -a -G plugdev $USER

# Cr√©ation du fichier de r√®gles udev
sudo nano /etc/udev/rules.d/90-libgphoto2.rules
```

Ajoutez cette ligne :
```
ACTION=="add", SUBSYSTEM=="usb", ATTRS{idVendor}=="04b0", ATTRS{idProduct}=="*", MODE="0660", GROUP="plugdev"
```

```bash
# Recharger les r√®gles udev
sudo udevadm control --reload-rules
sudo udevadm trigger

# Red√©marrage n√©cessaire
sudo reboot
```

### 2.3 Test de connexion

```bash
# Connectez le Nikon D50 en USB
# Allumez l'appareil

# D√©tection automatique
gphoto2 --auto-detect

# Test de capture
gphoto2 --capture-image-and-download
```

**Astuce** : Si l'appareil n'est pas d√©tect√©, d√©branchez-le, attendez 5 secondes, puis rebranchez-le.

---

## üñ®Ô∏è √âtape 3 : Configuration de l'imprimante

### 3.1 Installation de CUPS

```bash
# Installation du syst√®me d'impression
sudo apt install -y cups cups-client

# Ajout de l'utilisateur au groupe lpadmin
sudo usermod -a -G lpadmin $USER

# D√©marrage du service CUPS
sudo systemctl enable cups
sudo systemctl start cups
```

### 3.2 Configuration de l'imprimante via interface web

```bash
# Acc√©dez √† l'interface CUPS depuis le navigateur
# URL : http://localhost:631

# Ou depuis un autre ordinateur sur le r√©seau :
# http://[IP_du_Raspberry]:631
```

**Via l'interface CUPS :**
1. Cliquez sur "Administration"
2. "Add Printer"
3. S√©lectionnez votre imprimante USB
4. Suivez l'assistant (choisissez le pilote appropri√©)
5. Cochez "Share This Printer"

### 3.3 Configuration en ligne de commande

```bash
# Liste des imprimantes d√©tect√©es
lpstat -p -d

# D√©finir l'imprimante par d√©faut
lpoptions -d nom_de_votre_imprimante

# Test d'impression
lp -d nom_de_votre_imprimante test.jpg
```

### 3.4 Installation de pilotes sp√©cifiques

```bash
# Pour Canon Selphy
sudo apt install -y printer-driver-gutenprint

# Pour Epson
sudo apt install -y printer-driver-escpr

# Pour HP
sudo apt install -y hplip
```

---

## üñ•Ô∏è √âtape 4 : Configuration de l'√©cran tactile

### 4.1 Branchement

1. Connectez le c√¢ble HDMI √† la sortie HDMI0 du Raspberry Pi
2. Connectez le c√¢ble USB pour le tactile
3. Alimentez l'√©cran si n√©cessaire

### 4.2 Calibration tactile

```bash
# Installation de l'outil de calibration
sudo apt install -y xinput-calibrator

# Lancement de la calibration
DISPLAY=:0 xinput_calibrator
```

Suivez les instructions √† l'√©cran (touchez les croix).

### 4.3 Sauvegarde de la calibration

```bash
# Les r√©sultats s'affichent dans le terminal
# Copiez la section "Section InputClass"
sudo nano /etc/X11/xorg.conf.d/99-calibration.conf
```

Collez le contenu obtenu, exemple :
```
Section "InputClass"
    Identifier "calibration"
    MatchProduct "eGalax Inc. USB TouchController"
    Option "Calibration" "3996 122 208 3996"
    Option "SwapAxes" "0"
EndSection
```

---

## üêç √âtape 5 : Installation de l'application Python

### 5.1 Installation des d√©pendances

```bash
# Biblioth√®ques Python
sudo apt install -y python3-pip python3-tk python3-pil python3-pil.imagetk

# Installation de Pillow (si pas d√©j√† install√©)
pip3 install Pillow

# Pour l'impression depuis Python
pip3 install pycups
```

### 5.2 T√©l√©chargement du script

```bash
# Cr√©ez un dossier pour le projet
mkdir ~/photomaton
cd ~/photomaton

# Cr√©ez le fichier principal
nano photomaton.py
```

Copiez le code Python fourni pr√©c√©demment et ajoutez le module d'impression.

### 5.3 Script d'impression am√©lior√©

Cr√©ez un nouveau fichier pour g√©rer l'impression :

```bash
nano printer_manager.py
```

```python
import cups
import subprocess
from pathlib import Path

class PrinterManager:
    def __init__(self):
        self.conn = cups.Connection()
        self.printers = self.conn.getPrinters()
        self.default_printer = self.get_default_printer()
    
    def get_default_printer(self):
        """R√©cup√®re l'imprimante par d√©faut"""
        printers = self.conn.getPrinters()
        for name, info in printers.items():
            if info.get('printer-is-default', False):
                return name
        return list(printers.keys())[0] if printers else None
    
    def list_printers(self):
        """Liste toutes les imprimantes"""
        return list(self.printers.keys())
    
    def print_image(self, image_path, copies=1, printer_name=None):
        """Imprime une image"""
        if not printer_name:
            printer_name = self.default_printer
        
        if not printer_name:
            raise Exception("Aucune imprimante disponible")
        
        try:
            # Options d'impression
            options = {
                'copies': str(copies),
                'media': 'photo',  # Format photo
                'fit-to-page': 'True',
                'scaling': '100'
            }
            
            # Envoi de l'impression
            job_id = self.conn.printFile(
                printer_name,
                str(image_path),
                "Photomaton",
                options
            )
            
            return job_id
            
        except Exception as e:
            print(f"Erreur impression: {e}")
            return None
    
    def get_printer_status(self, printer_name=None):
        """V√©rifie le statut de l'imprimante"""
        if not printer_name:
            printer_name = self.default_printer
        
        try:
            attrs = self.conn.getPrinterAttributes(printer_name)
            state = attrs.get('printer-state', 0)
            
            states = {
                3: "Inactive",
                4: "En cours d'impression",
                5: "Arr√™t√©e"
            }
            
            return states.get(state, "Inconnue")
        except:
            return "Non disponible"
```

---

## üé® √âtape 6 : Script Python complet avec impression

```bash
nano photomaton_complet.py
```

Le script complet int√®gre :
- Interface tactile Tkinter
- Contr√¥le du Nikon D50
- Gestion d'impression
- Planche contact 4 photos
- Galerie
- Aper√ßu avant impression

---

## üèóÔ∏è √âtape 7 : Construction de la borne physique

### 7.1 Mat√©riaux pour le bo√Ætier

**Option √©conomique :**
- Contreplaqu√© 10mm
- Pieds en caoutchouc
- Peinture ou vinyle adh√©sif

**Option premium :**
- MDF 12mm
- Plexiglass pour la fa√ßade
- LED RGB pour l'√©clairage

### 7.2 Dimensions recommand√©es

```
Hauteur : 150 cm (√† ajuster selon votre taille)
Largeur : 60 cm
Profondeur : 40 cm

Compartiments :
- √âcran tactile : partie haute centrale
- Cam√©ra D50 : 20cm au-dessus de l'√©cran
- Imprimante : partie basse
- Raspberry Pi : partie arri√®re
- Tiroir sortie photos : partie basse fa√ßade
```

### 7.3 C√¢blage interne

```
Raspberry Pi 4
‚îú‚îÄ‚îÄ HDMI ‚Üí √âcran tactile
‚îú‚îÄ‚îÄ USB 1 ‚Üí √âcran tactile (touch)
‚îú‚îÄ‚îÄ USB 2 ‚Üí Nikon D50
‚îú‚îÄ‚îÄ USB 3 ‚Üí Hub USB aliment√©
‚îÇ   ‚îú‚îÄ‚îÄ Imprimante
‚îÇ   ‚îî‚îÄ‚îÄ Bouton arcade (optionnel)
‚îî‚îÄ‚îÄ Alimentation 5V 3A
```

**Conseil** : Utilisez des serre-c√¢bles et du velcro pour organiser les c√¢bles.

---

## üöÄ √âtape 8 : Lancement automatique au d√©marrage

### 8.1 Cr√©ation d'un service systemd

```bash
sudo nano /etc/systemd/system/photomaton.service
```

Contenu du fichier :
```ini
[Unit]
Description=Photomaton Application
After=graphical.target

[Service]
Type=simple
User=pi
Environment=DISPLAY=:0
Environment=XAUTHORITY=/home/pi/.Xauthority
WorkingDirectory=/home/pi/photomaton
ExecStart=/usr/bin/python3 /home/pi/photomaton/photomaton_complet.py
Restart=on-failure
RestartSec=5s

[Install]
WantedBy=graphical.target
```

```bash
# Activation du service
sudo systemctl daemon-reload
sudo systemctl enable photomaton.service
sudo systemctl start photomaton.service

# V√©rification du statut
sudo systemctl status photomaton.service
```

### 8.2 Alternative : lancement via autostart

```bash
mkdir -p ~/.config/autostart
nano ~/.config/autostart/photomaton.desktop
```

Contenu :
```ini
[Desktop Entry]
Type=Application
Name=Photomaton
Exec=python3 /home/pi/photomaton/photomaton_complet.py
Terminal=false
```

---

## üîß √âtape 9 : Optimisations et r√©glages

### 9.1 D√©sactiver l'√©cran de veille

```bash
sudo nano /etc/xdg/lxsession/LXDE-pi/autostart
```

Ajoutez :
```
@xset s off
@xset -dpms
@xset s noblank
```

### 9.2 Masquer le curseur de souris

```bash
sudo apt install -y unclutter
nano ~/.config/autostart/unclutter.desktop
```

```ini
[Desktop Entry]
Type=Application
Name=Unclutter
Exec=unclutter -idle 0.1 -root
```

### 9.3 Performance du Raspberry Pi

```bash
sudo nano /boot/config.txt
```

Ajoutez :
```
# GPU
gpu_mem=256

# Overclock l√©ger (optionnel)
over_voltage=2
arm_freq=1750
```

---

## üß™ √âtape 10 : Tests et d√©pannage

### 10.1 Checklist de test

- [ ] L'√©cran tactile r√©pond correctement
- [ ] Le Nikon D50 est d√©tect√© par gPhoto2
- [ ] Les photos sont captur√©es et sauvegard√©es
- [ ] L'imprimante est d√©tect√©e et imprime
- [ ] L'application d√©marre automatiquement
- [ ] Le compte √† rebours fonctionne
- [ ] La planche contact est g√©n√©r√©e

### 10.2 Probl√®mes courants

**L'appareil photo n'est pas d√©tect√© :**
```bash
# Tuer les processus qui bloquent gPhoto2
killall gvfsd-gphoto2
sudo systemctl stop gvfs-gphoto2-volume-monitor

# D√©sactiver d√©finitivement
sudo chmod -x /usr/lib/gvfs/gvfs-gphoto2-volume-monitor
```

**L'imprimante ne r√©pond pas :**
```bash
# V√©rifier CUPS
sudo systemctl status cups

# Voir la file d'attente
lpstat -o

# Annuler tous les jobs
cancel -a
```

**√âcran tactile invers√© :**
```bash
# Modifier la calibration
sudo nano /etc/X11/xorg.conf.d/99-calibration.conf
# Changez SwapAxes de 0 √† 1
```

---

## üìä √âtape 11 : Statistiques et maintenance

### 11.1 Logs de l'application

```bash
# Voir les logs en temps r√©el
journalctl -u photomaton.service -f

# Logs complets
journalctl -u photomaton.service
```

### 11.2 Compteur de photos

Ajoutez cette fonction au script Python :
```python
def get_stats(self):
    """Compte le nombre de photos prises"""
    photos = list(self.photo_dir.glob("photo_*.jpg"))
    planches = list(self.photo_dir.glob("planche_*.jpg"))
    return len(photos), len(planches)
```

### 11.3 Sauvegarde automatique

```bash
# Script de backup quotidien
nano ~/backup_photos.sh
```

```bash
#!/bin/bash
DATE=$(date +%Y%m%d)
rsync -av ~/Photos_Photomaton/ /media/usb/backup_$DATE/
```

```bash
chmod +x ~/backup_photos.sh

# Ajouter au crontab (tous les jours √† 23h)
crontab -e
# Ajoutez :
0 23 * * * /home/pi/backup_photos.sh
```

---

## üéâ √âtape 12 : Personnalisation

### 12.1 Th√®me personnalis√©

Modifiez les couleurs dans le script Python :
```python
# Palette de couleurs
COLORS = {
    'bg': '#1a1a2e',        # Fond principal
    'primary': '#00d4ff',    # Bouton principal
    'secondary': '#e94560',  # Bouton secondaire
    'text': '#ffffff'        # Texte
}
```

### 12.2 Logo et branding

```python
# Ajoutez votre logo
logo = Image.open('logo.png')
logo_tk = ImageTk.PhotoImage(logo)
logo_label = tk.Label(frame, image=logo_tk)
logo_label.pack()
```

### 12.3 Effets sonores

```bash
sudo apt install -y sox

# Dans le script Python
import os
os.system('play click.wav')  # Au d√©clenchement
os.system('play flash.wav')  # √Ä la prise de photo
```

---

## üìö Ressources suppl√©mentaires

### Documentation
- [gPhoto2 Documentation](http://gphoto.org/doc/)
- [CUPS Documentation](https://www.cups.org/documentation.html)
- [Raspberry Pi GPIO](https://pinout.xyz/)

### Communaut√©
- Forum Raspberry Pi : raspberrypi.org/forums
- Reddit : r/raspberry_pi

### Pi√®ces d√©tach√©es
- Papier photo 10x15cm compatible
- Cartouches d'encre/rubans pour imprimante
- C√¢bles USB de rechange

---

## ‚úÖ R√©sultat final

Vous avez maintenant un photomaton professionnel avec :
- ‚úÖ Interface tactile intuitive 1024x600
- ‚úÖ Appareil photo Nikon D50 contr√¥l√©
- ‚úÖ Impression automatique des planches 4 photos
- ‚úÖ Galerie int√©gr√©e
- ‚úÖ D√©marrage automatique
- ‚úÖ Syst√®me stable et fiable

**Co√ªt total estim√© : 400-600‚Ç¨** (selon le mat√©riel d√©j√† poss√©d√©)

---

## üîÑ Mises √† jour futures possibles

- QR code pour t√©l√©charger les photos
- Filtres et effets en temps r√©el
- Envoi par email automatique
- Partage sur r√©seaux sociaux
- Reconnaissance faciale
- Mode GIF anim√©
- √âcran de veille avec diaporama

**Bon montage ! üéâ**
