 
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation Compl√®te Photomaton</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 50px 40px;
            text-align: center;
        }
        
        header h1 {
            font-size: 3em;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        header p {
            font-size: 1.3em;
            opacity: 0.9;
        }
        
        .content {
            padding: 40px;
        }
        
        .toc {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 40px;
            border: 2px solid #e9ecef;
        }
        
        .toc h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        
        .toc ul {
            list-style: none;
            column-count: 2;
            column-gap: 30px;
        }
        
        .toc li {
            margin: 10px 0;
            break-inside: avoid;
        }
        
        .toc a {
            color: #667eea;
            text-decoration: none;
            transition: all 0.3s;
            display: block;
            padding: 5px 10px;
            border-radius: 5px;
        }
        
        .toc a:hover {
            background: #667eea;
            color: white;
            padding-left: 15px;
        }
        
        .section {
            margin-bottom: 50px;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #667eea;
            scroll-margin-top: 20px;
        }
        
        .section h2 {
            color: #2c3e50;
            margin-bottom: 25px;
            font-size: 2em;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .section h2::before {
            content: "‚ñ∂";
            color: #667eea;
            font-size: 0.7em;
        }
        
        .section h3 {
            color: #34495e;
            margin: 25px 0 15px 0;
            font-size: 1.4em;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
        }
        
        .code-block {
            background: #282c34;
            color: #abb2bf;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            line-height: 1.6;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .code-block .command {
            color: #98c379;
        }
        
        .code-block .comment {
            color: #5c6370;
        }
        
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .success-box {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .config-box {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .config-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #e9ecef;
        }
        
        .config-item:last-child {
            border-bottom: none;
        }
        
        .config-label {
            font-weight: 600;
            color: #495057;
        }
        
        .config-value {
            color: #212529;
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            padding: 4px 10px;
            border-radius: 4px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }
        
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }
        
        th {
            background: #2c3e50;
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .tag {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            margin: 5px 5px 5px 0;
            font-weight: 600;
        }
        
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 600;
        }
        
        .status.active {
            background: #d4edda;
            color: #155724;
        }
        
        .status.protected {
            background: #fff3cd;
            color: #856404;
        }
        
        ul, ol {
            margin-left: 25px;
            margin-top: 10px;
        }
        
        li {
            margin: 10px 0;
        }
        
        footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 30px;
        }
        
        footer p {
            margin: 5px 0;
        }
        
        .step {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        @media print {
            body {
                background: white;
                padding: 0;
            }
            .container {
                box-shadow: none;
            }
            .toc ul {
                column-count: 1;
            }
        }
        
        @media (max-width: 768px) {
            .toc ul {
                column-count: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üì∏ Documentation Photomaton</h1>
            <p>Guide complet d'installation, configuration et maintenance</p>
            <p style="font-size: 0.9em; margin-top: 15px; opacity: 0.8;">Raspberry Pi 4 + √âcran tactile + Canon SELPHY CP400</p>
        </header>
        
        <div class="content">
            <!-- TABLE DES MATI√àRES -->
            <div class="toc">
                <h2>üìã Table des mati√®res</h2>
                <ul>
                    <li><a href="#systeme">1. Syst√®me et mat√©riel</a></li>
                    <li><a href="#ecran-tactile">2. Configuration √©cran tactile</a></li>
                    <li><a href="#imprimante">3. Installation imprimante Canon CP400</a></li>
                    <li><a href="#autostart">4. D√©marrage automatique</a></li>
                    <li><a href="#plugins">5. Architecture plugins</a></li>
                    <li><a href="#analytics">6. Plugin Analytics</a></li>
                    <li><a href="#corrections">7. Corrections appliqu√©es</a></li>
                    <li><a href="#interface">8. Interface utilisateur</a></li>
                    <li><a href="#securite">9. S√©curit√© et mots de passe</a></li>
                    <li><a href="#tailscale">10. Acc√®s distant (Tailscale)</a></li>
                    <li><a href="#sauvegarde">11. Sauvegarde et restauration</a></li>
                    <li><a href="#commandes">12. Commandes utiles</a></li>
                </ul>
            </div>

            <!-- 1. SYST√àME ET MAT√âRIEL -->
            <div id="systeme" class="section">
                <h2>1. Syst√®me et mat√©riel</h2>
                
                <h3>Mat√©riel utilis√©</h3>
                <div class="config-box">
                    <div class="config-item">
                        <span class="config-label">Ordinateur</span>
                        <span class="config-value">Raspberry Pi 4</span>
                    </div>
                    <div class="config-item">
                        <span class="config-label">√âcran tactile</span>
                        <span class="config-value">Display-C 1024x600 Rev3.1 (QDtech)</span>
                    </div>
                    <div class="config-item">
                        <span class="config-label">Imprimante</span>
                        <span class="config-value">Canon SELPHY CP400</span>
                    </div>
                    <div class="config-item">
                        <span class="config-label">Alimentation</span>
                        <span class="config-value">3A minimum (officielle Raspberry Pi)</span>
                    </div>
                    <div class="config-item">
                        <span class="config-label">Dossier photos</span>
                        <span class="config-value">~/Photos_Photomaton</span>
                    </div>
                </div>

                <div class="warning-box">
                    <strong>‚ö†Ô∏è Important :</strong> Une alimentation USB insuffisante peut causer des probl√®mes d'instabilit√© du curseur tactile. Utilisez imp√©rativement une alimentation officielle Raspberry Pi 3A ou plus.
                </div>

                <h3>Connexions requises</h3>
                <ul>
                    <li><strong>√âcran :</strong> HDMI pour l'affichage + USB pour le tactile</li>
                    <li><strong>Imprimante :</strong> USB vers Raspberry Pi</li>
                    <li><strong>R√©seau :</strong> WiFi (configuration via interface tactile)</li>
                </ul>
            </div>

            <!-- 2. CONFIGURATION √âCRAN TACTILE -->
            <div id="ecran-tactile" class="section">
                <h2>2. Configuration √©cran tactile Display-C 1024x600</h2>
                
                <h3>üîç Diagnostic initial</h3>
                <p>V√©rifier la d√©tection du p√©riph√©rique tactile :</p>
                <div class="code-block">
<span class="command">lsusb</span>
<span class="comment"># Doit afficher : Bus 001 Device 004: ID 0483:5750 STMicroelectronics</span>

<span class="command">ls -la /dev/input/</span>
<span class="comment"># Doit montrer plusieurs event0, event1, etc.</span>
</div>

                <h3>‚öôÔ∏è Passage de Wayland √† X11</h3>
                <p>Le tactile n√©cessite X11 au lieu de Wayland :</p>
                <div class="code-block">
<span class="command">sudo raspi-config</span>
<span class="comment"># Naviguez vers : Advanced Options ‚Üí Wayland ‚Üí X11</span>
<span class="comment"># Puis red√©marrez</span>
</div>

                <h3>üìê Configuration de la r√©solution</h3>
                <p>Modifier le fichier de configuration :</p>
                <div class="code-block">
<span class="command">sudo nano /boot/firmware/config.txt</span>
<span class="comment"># ou</span>
<span class="command">sudo nano /boot/config.txt</span>
</div>

                <p>Ajouter ces lignes :</p>
                <div class="code-block">
hdmi_group=2
hdmi_mode=87
hdmi_cvt=1024 600 60 6 0 0 0
hdmi_drive=2
display_hdmi_rotate=0
</div>

                <h3>üñ±Ô∏è Configuration du mode personnalis√©</h3>
                <div class="code-block">
<span class="comment"># Installer les outils n√©cessaires</span>
<span class="command">sudo apt-get install x11-xserver-utils</span>

<span class="comment"># Cr√©er le mode personnalis√©</span>
<span class="command">DISPLAY=:0 xrandr --newmode "1024x600_60.00" 49.00 1024 1072 1168 1312 600 603 613 624 -hsync +vsync</span>
<span class="command">DISPLAY=:0 xrandr --addmode HDMI-1 1024x600_60.00</span>
<span class="command">DISPLAY=:0 xrandr --output HDMI-1 --mode 1024x600_60.00</span>
</div>

                <h3>‚úÖ V√©rification finale</h3>
                <div class="code-block">
<span class="comment"># V√©rifier que le tactile est reconnu</span>
<span class="command">export DISPLAY=:0</span>
<span class="command">xinput list</span>
<span class="comment"># Doit afficher : Ê∑±Âú≥Â∏ÇÂÖ®Âä®ÁîµÂ≠êÊäÄÊúØÊúâÈôêÂÖ¨Âè∏ ByQDtech Ëß¶ÊéßUSBÈº†Ê†á</span>

<span class="comment"># Tester les √©v√©nements tactiles</span>
<span class="command">sudo apt-get install evtest</span>
<span class="command">sudo evtest</span>
<span class="comment"># S√©lectionner le p√©riph√©rique ByQDtech et toucher l'√©cran</span>
</div>

                <div class="success-box">
                    <strong>‚úÖ R√©sultat :</strong> Le tactile fonctionne correctement apr√®s avoir r√©solu le probl√®me d'alimentation USB.
                </div>
            </div>

            <!-- 3. INSTALLATION IMPRIMANTE -->
            <div id="imprimante" class="section">
                <h2>3. Installation Canon SELPHY CP400</h2>
                
                <div class="info-box">
                    <strong>‚ÑπÔ∏è Pourquoi un backend personnalis√© ?</strong> Le backend Gutenprint standard a un bug de d√©tection du type de papier (erreur "01 vs 11"). Le backend personnalis√© de selphy_print r√©sout ce probl√®me.
                </div>

                <h3>Pr√©requis et pr√©paration</h3>
                <div class="step">
                    <h4>Installation des d√©pendances</h4>
                    <div class="code-block">
<span class="command">sudo apt update</span>
<span class="command">sudo apt install -y build-essential git libusb-1.0-0-dev libjpeg-dev \
                    libcups2-dev libcupsimage2-dev pkg-config cups</span>
</div>
                </div>

                <div class="step">
                    <h4>V√©rifier la connexion de l'imprimante</h4>
                    <div class="code-block">
<span class="command">lsusb | grep Canon</span>
<span class="comment"># Vous devriez voir : ID 04a9:30f6 Canon, Inc. SELPHY CP400</span>
</div>
                </div>

                <h3>Installation du backend personnalis√©</h3>
                <div class="code-block">
<span class="comment"># Aller dans le r√©pertoire home</span>
<span class="command">cd ~</span>

<span class="comment"># Cloner le d√©p√¥t (supprimer l'ancien s'il existe)</span>
<span class="command">rm -rf selphy_print</span>
<span class="command">git clone https://git.shaftnet.org/gitea/slp/selphy_print.git</span>

<span class="comment"># Entrer dans le r√©pertoire</span>
<span class="command">cd selphy_print</span>

<span class="comment"># Compiler et installer</span>
<span class="command">sudo make install</span>
</div>

                <div class="success-box">
                    <strong>‚úì V√©rification :</strong> Le make install devrait afficher :
                    <div class="code-block" style="margin-top: 10px;">
GUTENPRINT VER:    5.3
CUPS BACKEND DIR:  /usr/lib/cups/backend
BACKEND NAME:      gutenprint53+usb
</div>
                </div>

                <h3>Configuration de CUPS</h3>
                <div class="step">
                    <h4>1. Modifier la configuration CUPS</h4>
                    <div class="code-block">
<span class="command">sudo nano /etc/cups/cupsd.conf</span>
</div>
                    <p>Trouver la section <code>&lt;Location /&gt;</code> et ajouter <code>Allow @LOCAL</code> :</p>
                    <div class="code-block">
&lt;Location /&gt;
  Order allow,deny
  Allow @LOCAL
&lt;/Location&gt;

&lt;Location /admin&gt;
  AuthType Default
  Require user @SYSTEM
  Order allow,deny
  Allow @LOCAL
&lt;/Location&gt;
</div>
                </div>

                <div class="step">
                    <h4>2. Ajouter l'utilisateur au groupe lpadmin</h4>
                    <div class="code-block">
<span class="command">sudo usermod -a -G lpadmin $USER</span>
<span class="comment"># D√©connectez-vous et reconnectez-vous apr√®s cette commande</span>
</div>
                </div>

                <div class="step">
                    <h4>3. Red√©marrer CUPS</h4>
                    <div class="code-block">
<span class="command">sudo systemctl restart cups</span>
<span class="command">sleep 3</span>
</div>
                </div>

                <h3>Configuration de l'imprimante</h3>
                <div class="step">
                    <h4>1. D√©tecter l'URI de l'imprimante</h4>
                    <div class="code-block">
<span class="command">lpinfo -v | grep -i usb</span>
<span class="comment"># Notez l'URI : gutenprint53+usb://canon-cp400/NONE_UNKNOWN</span>
</div>
                </div>

                <div class="step">
                    <h4>2. Supprimer les anciennes configurations</h4>
                    <div class="code-block">
<span class="command">lpstat -a</span>
<span class="command">sudo lpadmin -x CP_400</span>
<span class="command">sudo lpadmin -x SELPHY-CP400</span>
</div>
                </div>

                <div class="step">
                    <h4>3. Cr√©er l'imprimante</h4>
                    <div class="code-block">
<span class="command">sudo lpadmin -p CP_400 -E \
  -v "gutenprint53+usb://canon-cp400/NONE_UNKNOWN" \
  -m gutenprint.5.3://canon-cp400/expert</span>

<span class="command">sudo lpadmin -d CP_400</span>

<span class="command">lpstat -p CP_400</span>
<span class="comment"># Devrait afficher : printer CP_400 is idle. enabled since...</span>
</div>
                </div>

                <h3>Test d'impression</h3>
                <div class="code-block">
<span class="comment"># Imprimer une image</span>
<span class="command">lp -d CP_400 /chemin/vers/votre/image.jpg</span>

<span class="comment"># V√©rifier la file d'attente</span>
<span class="command">lpq -a</span>

<span class="comment"># Surveiller les logs</span>
<span class="command">sudo tail -f /var/log/cups/error_log</span>
</div>

                <h3>Options d'impression avanc√©es</h3>
                <div class="code-block">
<span class="comment"># Voir toutes les options</span>
<span class="command">lpoptions -p CP_400 -l</span>

<span class="comment"># Format carte postale</span>
<span class="command">lp -d CP_400 -o PageSize=Postcard image.jpg</span>

<span class="comment"># Sans bordures</span>
<span class="command">lp -d CP_400 -o StpBorderless=True image.jpg</span>
</div>

                <h3>D√©pannage imprimante</h3>
                <div class="warning-box">
                    <strong>Probl√®me : Jobs bloqu√©s</strong>
                    <div class="code-block" style="margin-top: 10px;">
<span class="command">cancel -a</span>
<span class="command">lpstat -p CP_400</span>
<span class="command">sudo cupsenable CP_400</span>
<span class="command">sudo cupsaccept CP_400</span>
</div>
                </div>

                <div class="info-box">
                    <strong>üí° Acc√®s interface web CUPS :</strong> <code>http://localhost:631</code>
                </div>
            </div>

            <!-- 4. D√âMARRAGE AUTOMATIQUE -->
            <div id="autostart" class="section">
                <h2>4. Lancement automatique du photomaton</h2>
                
                <h3>üìç Emplacement du script</h3>
                <div class="config-box">
                    <div class="config-item">
                        <span class="config-label">Script principal</span>
                        <span class="config-value">~/photomaton/photomaton_complet5.py</span>
                    </div>
                </div>

                <h3>üîß Cr√©ation du service systemd</h3>
                <div class="code-block">
<span class="command">sudo nano /etc/systemd/system/photomaton.service</span>
</div>

                <p>Contenu du fichier :</p>
                <div class="code-block">
[Unit]
Description=Photomaton Application
After=graphical.target

[Service]
Type=simple
User=vincent
Environment="DISPLAY=:0"
Environment="XAUTHORITY=/home/vincent/.Xauthority"
WorkingDirectory=/home/vincent/photomaton
ExecStart=/usr/bin/python3 /home/vincent/photomaton/photomaton_complet5.py
Restart=on-failure
RestartSec=10

[Install]
WantedBy=graphical.target
</div>

                <h3>‚ñ∂Ô∏è Activation du service</h3>
                <div class="code-block">
<span class="comment"># Recharger les services</span>
<span class="command">sudo systemctl daemon-reload</span>

<span class="comment"># Activer au d√©marrage</span>
<span class="command">sudo systemctl enable photomaton.service</span>

<span class="comment"># D√©marrer le service</span>
<span class="command">sudo systemctl start photomaton.service</span>

<span class="comment"># V√©rifier le statut</span>
<span class="command">sudo systemctl status photomaton.service</span>
</div>

                <h3>üõ†Ô∏è Commandes de gestion</h3>
                <div class="code-block">
<span class="comment"># Arr√™ter le service</span>
<span class="command">sudo systemctl stop photomaton.service</span>

<span class="comment"># Red√©marrer le service</span>
<span class="command">sudo systemctl restart photomaton.service</span>

<span class="comment"># D√©sactiver le d√©marrage automatique</span>
<span class="command">sudo systemctl disable photomaton.service</span>

<span class="comment"># Voir les logs en temps r√©el</span>
<span class="command">sudo journalctl -u photomaton.service -f</span>
</div>
            </div>

            <!-- 5. ARCHITECTURE PLUGINS -->
            <div id="plugins" class="section">
                <h2>5. Architecture plugins</h2>
                
                <h3>Plugins disponibles</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Plugin</th>
                            <th>Statut</th>
                            <th>Priorit√©</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Camera</strong></td>
                            <td><span class="status active">Actif</span></td>
                            <td>1</td>
                            <td>Gestion appareil Canon via gphoto2</td>
                        </tr>
                        <tr>
                            <td><strong>Printer</strong></td>
                            <td><span class="status active">Actif</span></td>
                            <td>2</td>
                            <td>Canon CP-400 via CUPS</td>
                        </tr>
                        <tr>
                            <td><strong>Decorator</strong></td>
                            <td><span class="status active">Actif</span></td>
                            <td>3</td>
                            <td>5 styles : Polaroid, Vintage, Timbre, F√™te, Normal</td>
                        </tr>
                        <tr>
                            <td><strong>WiFi</strong></td>
                            <td><span class="status active">Actif</span></td>
                            <td>4</td>
                            <td>Configuration r√©seau avec clavier virtuel</td>
                        </tr>
                        <tr>
                            <td><strong>QR Code</strong></td>
                            <td><span class="status active">Actif</span></td>
                            <td>5</td>
                            <td>G√©n√©ration QR + serveur web (port 8000)</td>
                        </tr>
                        <tr>
                            <td><strong>NextCloud</strong></td>
                            <td><span class="status active">Actif</span></td>
                            <td>6</td>
                            <td>Upload automatique vers le cloud</td>
                        </tr>
                        <tr>
                            <td><strong>Analytics</strong></td>
                            <td><span class="status active">Actif</span> <span class="status protected">Prot√©g√©</span></td>
                            <td>12</td>
                            <td>Statistiques d'utilisation compl√®tes</td>
                        </tr>
                    </tbody>
                </table>

                <h3>Configuration plugins</h3>
                <div class="config-box">
                    <div class="config-item">
                        <span class="config-label">Fichier de configuration</span>
                        <span class="config-value">~/.photomaton_plugins.json</span>
                    </div>
                    <div class="config-item">
                        <span class="config-label">Interface de gestion</span>
                        <span class="config-value">plugin_ui.py</span>
                    </div>
                </div>

                <div class="info-box">
                    <strong>üí° Activation/d√©sactivation :</strong> G√©rez les plugins via l'interface graphique sans modification de code.
                </div>
            </div>

            <!-- 6. PLUGIN ANALYTICS -->
            <div id="analytics" class="section">
                <h2>6. Plugin Analytics</h2>
                <span class="tag">Nouveau</span>
                <span class="tag">Protection par mot de passe</span>
                
                <h3>Fonctionnalit√©s</h3>
                <div class="config-box">
                    <strong>Tracking automatique :</strong>
                    <ul style="margin-top: 10px;">
                        <li>Sessions totales</li>
                        <li>Photos prises (compteur)</li>
                        <li>Impressions effectu√©es</li>
                        <li>QR Codes g√©n√©r√©s</li>
                        <li>Style pr√©f√©r√©</li>
                        <li>Jour/heure de pointe</li>
                    </ul>
                </div>

                <h3>S√©curit√©</h3>
                <div class="warning-box">
                    <strong>Acc√®s prot√©g√© par mot de passe</strong>
                    <ul style="margin-top: 10px;">
                        <li>Mot de passe requis pour afficher les statistiques</li>
                        <li>Mot de passe requis pour r√©initialiser</li>
                        <li>Clavier virtuel disponible pour la saisie</li>
                        <li>M√™me mot de passe que le compteur d'impressions</li>
                    </ul>
                </div>

                <div class="config-box">
                    <div class="config-item">
                        <span class="config-label">Mot de passe par d√©faut</span>
                        <span class="config-value">admin123</span>
                    </div>
                    <div class="config-item">
                        <span class="config-label">Fichier de donn√©es</span>
                        <span class="config-value">~/.photomaton_analytics.json</span>
                    </div>
                    <div class="config-item">
                        <span class="config-label">Acc√®s interface</span>
                        <span class="config-value">Bouton "Stats"</span>
                    </div>
                </div>

                <h3>Script de gestion du mot de passe</h3>
                <div class="code-block">
<span class="command">python3 change_password.py</span>

<span class="comment"># Actions :</span>
<span class="comment"># 1. V√©rification ancien mot de passe</span>
<span class="comment"># 2. Saisie nouveau mot de passe (min 4 caract√®res)</span>
<span class="comment"># 3. Confirmation</span>
<span class="comment"># 4. Mise √† jour automatique</span>
</div>
            </div>

            <!-- 7. CORRECTIONS APPLIQU√âES -->
            <div id="corrections" class="section">
                <h2>7. Corrections appliqu√©es</h2>
                
                <h3>1. WiFi - Clavier virtuel</h3>
                <div class="config-box">
                    <div class="success-box">
                        <strong>Probl√®me r√©solu :</strong> Le clavier virtuel restait sous la fen√™tre de mot de passe WiFi
                    </div>
                    <ul style="margin-top: 10px;">
                        <li>Clavier positionn√© automatiquement sous la fen√™tre</li>
                        <li>Attribut <code>topmost</code> ajout√©</li>
                        <li>D√©tection de d√©bordement d'√©cran (600px max)</li>
                        <li>Fen√™tre mot de passe r√©duite : 450x180px</li>
                        <li>Clavier compact : 900x240px</li>
                    </ul>
                    <div class="code-block">
<span class="comment">Fichier :</span> wifi_config_ui.py
<span class="comment">Taille fen√™tre :</span> 450x180 (au lieu de 400x250)
<span class="comment">Taille clavier :</span> 900x240 (au lieu de 800x300)
<span class="comment">Position :</span> y = password_dialog.y + height + 5
                    </div>
                </div>

                <h3>2. Affichage des photos - S√©lection</h3>
                <div class="config-box">
                    <div class="success-box">
                        <strong>Probl√®me r√©solu :</strong> Les photos √©taient coup√©es dans la fen√™tre de s√©lection
                    </div>
                    <ul style="margin-top: 10px;">
                        <li>Fen√™tre agrandie : 1000x700px</li>
                        <li>Canvas avec scrollbar ajout√©</li>
                        <li>Calcul de taille adaptatif (2 ou 3 colonnes)</li>
                        <li>Conservation des proportions (aspect ratio)</li>
                        <li>Images centr√©es dans leur conteneur</li>
                    </ul>
                    <div class="code-block">
<span class="comment">Script :</span> patch_integration_complete.py
<span class="comment">Fonction :</span> show_print_selection()
<span class="comment">Layout :</span> 2 colonnes (‚â§4 photos) ou 3 colonnes (>4 photos)
                    </div>
                </div>
            </div>

            <!-- 8. INTERFACE UTILISATEUR -->
            <div id="interface" class="section">
                <h2>8. Interface utilisateur</h2>
                
                <h3>√âcran principal</h3>
                <div class="config-box">
                    <strong>Panneau de contr√¥le :</strong>
                    <ul style="margin-top: 10px;">
                        <li><strong>Choix style</strong> : Bouton violet variable (selon style actif)</li>
                        <li><strong>Test photo</strong> : Bouton bleu</li>
                        <li><strong>Prendre 4 photos</strong> : Bouton vert principal</li>
                        <li><strong>Galerie</strong> : Bouton rouge</li>
                    </ul>
                    
                    <strong style="display: block; margin-top: 15px;">Boutons maintenance :</strong>
                    <ul style="margin-top: 10px;">
                        <li>Diagnostic imprimante</li>
                        <li>Annuler jobs</li>
                        <li>Reset imprimante</li>
                    </ul>
                    
                    <strong style="display: block; margin-top: 15px;">Boutons r√©seau :</strong>
                    <ul style="margin-top: 10px;">
                        <li>WiFi (configuration)</li>
                        <li>QR Code (g√©n√©ration)</li>
                        <li>NextCloud (upload)</li>
                        <li><strong>Stats</strong> (Analytics - nouveau)</li>
                    </ul>
                </div>

                <h3>Fen√™tre de s√©lection photos</h3>
                <div class="config-box">
                    <ul>
                        <li>Affichage optimis√© (1000x700px)</li>
                        <li>Layout adaptatif (2 ou 3 colonnes selon nombre de photos)</li>
                        <li>Images proportionnelles et centr√©es</li>
                        <li>Scrollbar automatique si n√©cessaire</li>
                        <li>Actions : Imprimer / QR Code / Tout imprimer</li>
                    </ul>
                </div>

                <h3>‚å®Ô∏è Clavier virtuel</h3>
                <div class="config-box">
                    <strong>Disponible dans :</strong>
                    <ul style="margin-top: 10px;">
                        <li>Configuration WiFi (mot de passe r√©seau)</li>
                        <li>Acc√®s statistiques (mot de passe admin)</li>
                        <li>R√©initialisation statistiques</li>
                        <li>Changement de mot de passe</li>
                    </ul>
                    
                    <div style="margin-top: 15px;">
                        <div class="config-item">
                            <span class="config-label">Taille</span>
                            <span class="config-value">900x240 px</span>
                        </div>
                        <div class="config-item">
                            <span class="config-label">Layout</span>
                            <span class="config-value">4 lignes √ó 10 touches</span>
                        </div>
                        <div class="config-item">
                            <span class="config-label">Position</span>
                            <span class="config-value">Auto sous fen√™tre parente</span>
                        </div>
                        <div class="config-item">
                            <span class="config-label">Boutons sp√©ciaux</span>
                            <span class="config-value">ESPACE, Retour, Effacer, Fermer</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 9. S√âCURIT√â -->
            <div id="securite" class="section">
                <h2>9. S√©curit√© et mots de passe</h2>
                
                <h3>Fonctionnalit√©s prot√©g√©es</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Fonctionnalit√©</th>
                            <th>Protection</th>
                            <th>Mot de passe par d√©faut</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Compteur d'impressions</td>
                            <td>R√©initialisation</td>
                            <td>admin123</td>
                        </tr>
                        <tr>
                            <td>Statistiques (Analytics)</td>
                            <td>Affichage + R√©initialisation</td>
                            <td>admin123</td>
                        </tr>
                    </tbody>
                </table>

                <div class="warning-box">
                    <strong>Important :</strong> Les deux fonctionnalit√©s partagent le m√™me mot de passe stock√© dans <code>~/.photomaton_print_counter.json</code>
                </div>

                <h3>Changement du mot de passe</h3>
                <div class="code-block">
<span class="command">cd ~/photomaton</span>
<span class="command">python3 change_password.py</span>

<span class="comment"># Le script vous guidera :</span>
<span class="comment"># 1. Entrer l'ancien mot de passe</span>
<span class="comment"># 2. Entrer le nouveau (minimum 4 caract√®res)</span>
<span class="comment"># 3. Confirmer le nouveau</span>
<span class="comment"># 4. Validation automatique</span>
</div>

                <div class="info-box">
                    <strong>üí° Recommandation :</strong> Changez le mot de passe par d√©faut d√®s la premi√®re utilisation pour s√©curiser l'acc√®s aux statistiques et au compteur d'impressions.
                </div>
            </div>

            <!-- 10. TAILSCALE -->
            <div id="tailscale" class="section">
                <h2>10. Acc√®s distant avec Tailscale</h2>
                
                <div class="info-box">
                    <strong>‚ÑπÔ∏è Pourquoi Tailscale ?</strong> Solution VPN gratuite et s√©curis√©e permettant un acc√®s SSH depuis n'importe o√π sans configuration r√©seau complexe.
                </div>

                <h3>üì• Installation</h3>
                <div class="code-block">
<span class="command">curl -fsSL https://tailscale.com/install.sh | sh</span>
</div>

                <h3>üîê Connexion initiale</h3>
                <div class="code-block">
<span class="command">sudo tailscale up</span>
<span class="comment"># Suivre le lien affich√© pour autoriser l'appareil</span>
</div>

                <h3>üåê R√©cup√©ration de l'IP Tailscale</h3>
                <div class="code-block">
<span class="command">tailscale ip -4</span>
<span class="comment"># Exemple de r√©sultat : 100.85.123.45</span>
</div>

                <h3>üîÑ Activation automatique au d√©marrage</h3>
                <div class="code-block">
<span class="command">sudo systemctl enable tailscaled</span>
<span class="command">sudo systemctl start tailscaled</span>
</div>

                <h3>üíª Connexion depuis un autre appareil</h3>
                
                <div class="step">
                    <h4>Sur PC/Mac/Linux :</h4>
                    <div class="code-block">
<span class="comment"># Installer Tailscale</span>
<span class="command">curl -fsSL https://tailscale.com/install.sh | sh</span>
<span class="command">sudo tailscale up</span>

<span class="comment"># Se connecter au RPi</span>
<span class="command">ssh vincent@100.85.123.45</span>
</div>
                </div>

                <div class="step">
                    <h4>Sur Windows :</h4>
                    <ol>
                        <li>T√©l√©charger : <a href="https://tailscale.com/download/windows" target="_blank">https://tailscale.com/download/windows</a></li>
                        <li>Installer et se connecter avec le m√™me compte</li>
                        <li>Utiliser PuTTY ou Windows Terminal pour SSH</li>
                    </ol>
                </div>

                <div class="step">
                    <h4>Sur smartphone :</h4>
                    <ol>
                        <li>Installer l'app Tailscale (Play Store / App Store)</li>
                        <li>Se connecter avec le m√™me compte</li>
                        <li>Installer une app SSH (Termius, JuiceSSH)</li>
                        <li>Se connecter √† l'IP Tailscale du RPi</li>
                    </ol>
                </div>

                <h3>üìä Commandes utiles</h3>
                <div class="code-block">
<span class="comment"># Voir tous les appareils connect√©s</span>
<span class="command">tailscale status</span>

<span class="comment"># Ping un appareil</span>
<span class="command">tailscale ping photomaton</span>

<span class="comment"># Se d√©connecter</span>
<span class="command">sudo tailscale down</span>

<span class="comment"># Se reconnecter</span>
<span class="command">sudo tailscale up</span>

<span class="comment"># Voir les logs</span>
<span class="command">sudo journalctl -u tailscaled</span>
</div>

                <div class="success-box">
                    <strong>‚úÖ Avantages :</strong>
                    <ul style="margin-top: 10px;">
                        <li>Fonctionne sur 4G, WiFi public, derri√®re firewall</li>
                        <li>Pas besoin d'ouvrir de ports sur la box internet</li>
                        <li>Chiffrement WireGuard s√©curis√©</li>
                        <li>IP stable pour le RPi</li>
                        <li>Gratuit jusqu'√† 100 appareils</li>
                    </ul>
                </div>

                <div class="warning-box">
                    <strong>üìû En cas de probl√®me lors d'un √©v√©nement :</strong>
                    <ol style="margin-top: 10px;">
                        <li>Activer Tailscale sur votre t√©l√©phone</li>
                        <li>Ouvrir votre app SSH</li>
                        <li>Se connecter : <code>ssh vincent@[IP-TAILSCALE]</code></li>
                        <li>Relancer : <code>sudo systemctl restart photomaton.service</code></li>
                    </ol>
                </div>
            </div>

            <!-- 11. SAUVEGARDE -->
            <div id="sauvegarde" class="section">
                <h2>11. Sauvegarde et restauration</h2>
                
                <h3>Script de sauvegarde carte SD</h3>
                <div class="info-box">
                    <strong>üíæ Script complet :</strong> backup_sd.sh
                </div>

                <div class="code-block">
<span class="command">sudo ./backup_sd.sh</span>

<span class="comment"># Actions automatiques :</span>
<span class="comment"># 1. Liste les p√©riph√©riques disponibles</span>
<span class="comment"># 2. D√©monte automatiquement la carte</span>
<span class="comment"># 3. Cr√©e l'image compl√®te</span>
<span class="comment"># 4. Propose la compression (gzip)</span>
<span class="comment"># 5. Affiche les instructions de restauration</span>

<span class="comment"># Destination :</span> ~/RPI_Backups/
<span class="comment"># Format :</span> rpi_photomaton_YYYYMMDD_HHMMSS.img.gz
</div>

                <h3>Restauration d'une sauvegarde</h3>
                <div class="code-block">
<span class="comment"># D√©compresser l'image</span>
<span class="command">gunzip rpi_photomaton_YYYYMMDD_HHMMSS.img.gz</span>

<span class="comment"># Identifier la carte SD (ex: /dev/sdb)</span>
<span class="command">lsblk</span>

<span class="comment"># Restaurer l'image</span>
<span class="command">sudo dd if=rpi_photomaton_YYYYMMDD_HHMMSS.img of=/dev/sdX bs=4M status=progress</span>
<span class="command">sync</span>
</div>

                <h3>Fichiers de configuration √† sauvegarder</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Fichier</th>
                            <th>Contenu</th>
                            <th>Emplacement</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Plugins</td>
                            <td>Configuration plugins</td>
                            <td><code>~/.photomaton_plugins.json</code></td>
                        </tr>
                        <tr>
                            <td>Compteur</td>
                            <td>Compteur + mot de passe</td>
                            <td><code>~/.photomaton_print_counter.json</code></td>
                        </tr>
                        <tr>
                            <td>Analytics</td>
                            <td>Donn√©es statistiques</td>
                            <td><code>~/.photomaton_analytics.json</code></td>
                        </tr>
                        <tr>
                            <td>WiFi</td>
                            <td>Marqueur WiFi configur√©</td>
                            <td><code>~/.photomaton_wifi_configured</code></td>
                        </tr>
                        <tr>
                            <td>NextCloud</td>
                            <td>Credentials cloud</td>
                            <td><code>~/.photomaton_nextcloud.json</code></td>
                        </tr>
                        <tr>
                            <td>Photos</td>
                            <td>Toutes les photos prises</td>
                            <td><code>~/Photos_Photomaton/</code></td>
                        </tr>
                    </tbody>
                </table>

                <div class="warning-box">
                    <strong>‚ö†Ô∏è Recommandation :</strong> Effectuez une sauvegarde compl√®te avant et apr√®s chaque √©v√©nement important.
                </div>
            </div>

            <!-- 12. COMMANDES UTILES -->
            <div id="commandes" class="section">
                <h2>12. Commandes utiles</h2>
                
                <h3>üñ•Ô∏è Syst√®me</h3>
                <div class="code-block">
<span class="comment"># Red√©marrer</span>
<span class="command">sudo reboot</span>

<span class="comment"># √âteindre</span>
<span class="command">sudo shutdown -h now</span>

<span class="comment"># Voir l'utilisation CPU/RAM</span>
<span class="command">htop</span>

<span class="comment"># Espace disque</span>
<span class="command">df -h</span>

<span class="comment"># Temp√©rature CPU</span>
<span class="command">vcgencmd measure_temp</span>
</div>

                <h3>üîß Services</h3>
                <div class="code-block">
<span class="comment"># Lister tous les services</span>
<span class="command">systemctl list-units --type=service</span>

<span class="comment"># Statut d'un service</span>
<span class="command">sudo systemctl status nom-du-service</span>

<span class="comment"># Red√©marrer un service</span>
<span class="command">sudo systemctl restart nom-du-service</span>

<span class="comment"># Voir les logs en temps r√©el</span>
<span class="command">sudo journalctl -u nom-du-service -f</span>
</div>

                <h3>üåê R√©seau</h3>
                <div class="code-block">
<span class="comment"># Voir les IP</span>
<span class="command">hostname -I</span>

<span class="comment"># Tester la connexion</span>
<span class="command">ping google.com</span>

<span class="comment"># Voir les ports ouverts</span>
<span class="command">sudo netstat -tulpn</span>

<span class="comment"># Statut WiFi</span>
<span class="command">iwconfig</span>
</div>

                <h3>üì∏ Photomaton</h3>
                <div class="code-block">
<span class="comment"># Relancer le photomaton</span>
<span class="command">sudo systemctl restart photomaton.service</span>

<span class="comment"># Voir les logs du photomaton</span>
<span class="command">sudo journalctl -u photomaton.service -f</span>

<span class="comment"># √âditer le script principal</span>
<span class="command">nano ~/photomaton/photomaton_complet5.py</span>

<span class="comment"># Tester le script manuellement</span>
<span class="command">cd ~/photomaton</span>
<span class="command">python3 photomaton_complet5.py</span>
</div>

                <h3>üñ±Ô∏è √âcran tactile</h3>
                <div class="code-block">
<span class="comment"># Voir la r√©solution actuelle</span>
<span class="command">DISPLAY=:0 xrandr</span>

<span class="comment"># Lister les p√©riph√©riques d'entr√©e</span>
<span class="command">DISPLAY=:0 xinput list</span>

<span class="comment"># Tester les √©v√©nements tactiles</span>
<span class="command">sudo evtest</span>
</div>

                <h3>üñ®Ô∏è Imprimante</h3>
                <div class="code-block">
<span class="comment"># Statut de l'imprimante</span>
<span class="command">lpstat -p CP_400</span>

<span class="comment"># Voir la file d'attente</span>
<span class="command">lpq -a</span>

<span class="comment"># Annuler tous les jobs</span>
<span class="command">cancel -a</span>

<span class="comment"># R√©activer l'imprimante</span>
<span class="command">sudo cupsenable CP_400</span>
<span class="command">sudo cupsaccept CP_400</span>

<span class="comment"># Logs CUPS</span>
<span class="command">sudo tail -f /var/log/cups/error_log</span>
</div>

                <h3>üìú Scripts de maintenance</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Script</th>
                            <th>Commande</th>
                            <th>Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Correction affichage</td>
                            <td><code>python3 patch_integration_complete.py</code></td>
                            <td>Corrige l'affichage des photos</td>
                        </tr>
                        <tr>
                            <td>Analytics</td>
                            <td><code>python3 patch_add_analytics.py</code></td>
                            <td>Int√®gre le plugin Analytics</td>
                        </tr>
                        <tr>
                            <td>Mot de passe</td>
                            <td><code>python3 change_password.py</code></td>
                            <td>Change le mot de passe admin</td>
                        </tr>
                        <tr>
                            <td>Sauvegarde SD</td>
                            <td><code>sudo ./backup_sd.sh</code></td>
                            <td>Sauvegarde compl√®te de la carte</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- R√âCAPITULATIF FINAL -->
            <div class="section" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
                <h2 style="color: white;">üéØ R√©capitulatif configuration</h2>
                
                <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 8px; margin: 20px 0;">
                    <h3 style="color: white; border: none; padding: 0; margin-bottom: 15px;">‚úÖ Fonctionnalit√©s op√©rationnelles</h3>
                    <ol style="font-size: 1.1em;">
                        <li><strong>√âcran tactile :</strong> Fonctionne en X11 avec r√©solution 1024x600</li>
                        <li><strong>Imprimante :</strong> Canon CP400 avec backend personnalis√© (sans erreur papier)</li>
                        <li><strong>Photomaton :</strong> Lancement automatique via systemd au d√©marrage</li>
                        <li><strong>Plugins :</strong> 7 plugins actifs (Camera, Printer, Decorator, WiFi, QR, NextCloud, Analytics)</li>
                        <li><strong>Interface :</strong> Clavier virtuel dans toutes les saisies prot√©g√©es</li>
                        <li><strong>Analytics :</strong> Tracking automatique avec protection par mot de passe</li>
                        <li><strong>Acc√®s distant :</strong> Tailscale pour SSH depuis n'importe o√π</li>
                        <li><strong>Sauvegarde :</strong> Script automatis√© pour carte SD compl√®te</li>
                    </ol>
                </div>
                
                <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 8px; margin: 20px 0;">
                    <h3 style="color: white; border: none; padding: 0; margin-bottom: 15px;">‚ö†Ô∏è Points d'attention</h3>
                    <ul style="font-size: 1.05em;">
                        <li>Mot de passe par d√©faut : <strong>admin123</strong> (√† changer imm√©diatement)</li>
                        <li>Alimentation 3A minimum obligatoire pour la stabilit√©</li>
                        <li>Sauvegardes r√©guli√®res recommand√©es (avant/apr√®s √©v√©nements)</li>
                        <li>V√©rifier l'espace disque avant les √©v√©nements importants</li>
                    </ul>
                </div>
                
                <div style="background: rgba(255,255,255,0.2); padding: 20px; border-radius: 8px;">
                    <h3 style="color: white; border: none; padding: 0; margin-bottom: 15px;">üìû D√©pannage rapide en √©v√©nement</h3>
                    <ol style="font-size: 1.05em;">
                        <li>Activer Tailscale sur votre smartphone</li>
                        <li>Ouvrir votre app SSH (Termius, JuiceSSH)</li>
                        <li>Se connecter : <code style="background: rgba(0,0,0,0.3); padding: 3px 8px; border-radius: 3px;">ssh vincent@[IP-TAILSCALE]</code></li>
                        <li>Commandes de secours :
                            <ul style="margin-top: 10px;">
                                <li><code style="background: rgba(0,0,0,0.3); padding: 3px 8px; border-radius: 3px;">sudo systemctl restart photomaton.service</code></li>
                                <li><code style="background: rgba(0,0,0,0.3); padding: 3px 8px; border-radius: 3px;">cancel -a</code> (annuler impressions)</li>
                                <li><code style="background: rgba(0,0,0,0.3); padding: 3px 8px; border-radius: 3px;">sudo reboot</code> (red√©marrage complet)</li>
                            </ul>
                        </li>
                    </ol>
                </div>
            </div>
        </div>

        <footer>
            <p style="font-size: 1.3em; font-weight: bold;">üì∏ Photomaton v2.0</p>
            <p style="margin: 10px 0;">Architecture modulaire √† base de plugins</p>
            <p style="font-size: 0.9em; opacity: 0.8;">Documentation unifi√©e g√©n√©r√©e le 7 octobre 2025</p>
            <p style="margin-top: 15px; font-size: 0.95em;">Conservation recommand√©e avec les sauvegardes</p>
        </footer>
    </div>
</body>
</html>
